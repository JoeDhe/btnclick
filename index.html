<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PocketApp Install</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8T94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manif.json">
    <meta name="theme-color" content="white">
    
    <!-- iOS Support -->
    <link rel="apple-touch-icon" href="https://drive.google.com/uc?export=view&id=1bYFWFEiksjv1IvaCjYI8U3GQt-cPov_T">
    <meta name="apple-mobile-web-app-status-bar" content="white">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3102257023257490" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container d-flex vh-100 justify-content-center align-items-center text-center">    
        <div class="card border-white text-center">
            <img class="p-2 mx-auto" src="https://drive.google.com/uc?export=view&id=1bYFWFEiksjv1IvaCjYI8U3GQt-cPov_T" alt="App Icon" width="250">
            <div class="card-body">
                <p class="card-text" id="card-text">Silakan klik tombol dibawah ini untuk menginstall aplikasi</p>
                <button id="installBtn" class="alert alert-success fw-bold fs-4 text-center" disabled>Tunggu sebentar <span id="count"></span></button>
            </div>          
        </div>
    </div>
    
    <script>
        // Register the service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(() => {
                console.log('Service Worker registered');
            }).catch(err => {
                console.error('Service Worker registration failed:', err);
            });
        }

        // Variables to manage the install prompt
        let promptEvent;
        let installButton = document.getElementById('installBtn');
        let cardInfo = document.getElementById("card-text");

        // Countdown for enabling install button
        let count = 12;
        let spn = document.getElementById("count");
        let timer = null;

        // Countdown function to enable the button after 12 seconds
        (function countDown() {
            spn.textContent = count;
            if (count !== 0) {
                timer = setTimeout(countDown, 1000);
                count--;
            } else {
                installButton.removeAttribute("disabled");
                installButton.textContent = "Install Aplikasi Sekarang";
                installButton.classList.remove('text-light');
            }
        })();

        // Listen for the 'beforeinstallprompt' event
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            promptEvent = e;  // Stash the event for later use
            installButton.removeAttribute('disabled');
            installButton.textContent = "Install Aplikasi Sekarang";
        });

        // Click event to show the install prompt
        installButton.addEventListener('click', async () => {
            if (!promptEvent) return;
            promptEvent.prompt();  // Show the install prompt

            const { outcome } = await promptEvent.userChoice;
            if (outcome === 'accepted') {
                installButton.style.display = "none";
                cardInfo.textContent = "Aplikasi berhasil diinstall, silakan buka lewat home screen.";
            }
            promptEvent = null;
        });

        // Listen for the 'appinstalled' event
        window.addEventListener('appinstalled', () => {
            installButton.style.display = "none";
            cardInfo.textContent = "Aplikasi berhasil diinstall, silakan buka lewat home screen.";
            document.cookie = "appinstalled=true; expires=Tue, 30 Mar 2025 23:59:59 GMT; path=/";
        });

        // Check if the app is already installed
        window.addEventListener('DOMContentLoaded', () => {
            if (window.matchMedia('(display-mode: standalone)').matches || window.matchMedia('(display-mode: fullscreen)').matches || window.matchMedia('(display-mode: minimal-ui)').matches) {
                installButton.style.display = "none";
                cardInfo.textContent = "Aplikasi berhasil diinstall, silakan buka lewat home screen.";
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>
